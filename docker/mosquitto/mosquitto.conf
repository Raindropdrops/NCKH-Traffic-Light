# Mosquitto Configuration for Traffic Light Demo
# See SPEC.md for topic tree and QoS settings

# =============================================================================
# LISTENER
# =============================================================================
listener 1883
protocol mqtt

# WebSocket listener for browser dashboard
listener 9001
protocol websockets

# =============================================================================
# AUTHENTICATION
# =============================================================================
# Disable anonymous access - require username/password
allow_anonymous false

# Password file (generate with mosquitto_passwd)
password_file /mosquitto/config/pwfile

# Access Control List
acl_file /mosquitto/config/aclfile

# =============================================================================
# PERSISTENCE (required for retained messages and LWT)
# =============================================================================
persistence true
persistence_location /mosquitto/data/

# Autosave interval (seconds)
autosave_interval 60

# =============================================================================
# LOGGING
# =============================================================================
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# CONNECTION SETTINGS
# =============================================================================
# Max keepalive (seconds) - ESP32 uses 30s
max_keepalive 60

# Message size limit (bytes) - matches ESP32 buffer
message_size_limit 1024

# =============================================================================
# RETAINED MESSAGES & LWT
# =============================================================================
# Retained messages enabled by default (required for status topic)
# No explicit config needed - Mosquitto 2.x supports retained by default

# Queue QoS 1/2 messages for offline clients
queue_qos0_messages false
max_queued_messages 1000
