# SPEC ‚Üî Implementation Matrix

> **Generated:** 2026-02-16 | **SPEC Version:** 1.0.1 (LOCKED)
> **Status:** mock-validated, hardware-pending

---

## Legend

| Status     | Meaning                                      |
| ---------- | -------------------------------------------- |
| ‚úÖ PASS    | Matches SPEC, evidence verified              |
| ‚ö†Ô∏è PARTIAL | Implemented with minor deviation, documented |
| ‚ùå FAIL    | Missing or violates SPEC                     |
| üî≤ N/A     | Requires hardware, cannot verify in mock     |

---

## 1. MQTT Topics & QoS (SPEC ¬ß2, ¬ß3)

| ID  | Requirement                                  | Status  | Evidence                                                                                                                                                                                                                                                                                                                                                              | Notes                             |
| --- | -------------------------------------------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------- |
| T1  | Topic base: `city/demo/intersection/001`     | ‚úÖ PASS | [mqtt_handler.c:227‚Äì236](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L227-L236>), [mock_esp32.py:41](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L41>), [dashboard:642](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L642>)                                                        | All three match                   |
| T2  | 5 topics: state, telemetry, cmd, ack, status | ‚úÖ PASS | [mqtt_handler.c:33‚Äì37](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L33-L37>), [mock_esp32.py:42‚Äì46](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L42-L46>)                                                                                                                                                | Firmware + mock both define all 5 |
| T3  | `cmd` QoS 1, not retained                    | ‚úÖ PASS | [mqtt_handler.c:192](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L192>) subscribe QoS1; [mock_esp32.py:81](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L81>)                                                                                                                                             | ‚Äî                                 |
| T4  | `ack` QoS 1, not retained                    | ‚úÖ PASS | [mqtt_handler.c:87](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L87>) publish QoS1 retain=0; [mock_esp32.py:192](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L192>)                                                                                                                                      | ‚Äî                                 |
| T5  | `status` QoS 1, retained (LWT)               | ‚úÖ PASS | [mqtt_handler.c:101‚Äì102](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L101-L102>) QoS1 retain=1; [mqtt_handler.c:263‚Äì264](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L263-L264>) LWT QoS1 retain=1; [mock_esp32.py:68](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L68>) | ‚Äî                                 |
| T6  | `state` QoS 0, not retained                  | ‚úÖ PASS | [mqtt_handler.c:299‚Äì300](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L299-L300>) QoS0 retain=0; [mock_esp32.py:204](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L204>)                                                                                                                                   | ‚Äî                                 |
| T7  | `telemetry` QoS 0, not retained              | ‚úÖ PASS | [mqtt_handler.c:319‚Äì320](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L319-L320>); [mock_esp32.py:222](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L222>)                                                                                                                                                 | ‚Äî                                 |

---

## 2. Payload Schemas (SPEC ¬ß4)

| ID  | Requirement                                                 | Status     | Evidence                                                                                                                                                                                                                                                                                                    | Notes                                                                                                                                                              |
| --- | ----------------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| P1  | `cmd` fields: cmd_id, type, mode, phase, duration_ms, ts_ms | ‚ö†Ô∏è PARTIAL | [dashboard:836‚Äì843](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L836-L843>) sends cmd_id, type, mode/phase, ts_ms                                                                                                                                                                    | `duration_ms` not sent by dashboard/smoke_test ‚Äî acceptable, field is optional                                                                                     |
| P2  | `ack` fields: cmd_id, ok, err, edge_recv_ts_ms              | ‚úÖ PASS    | [mqtt_handler.c:75‚Äì83](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L75-L83>); [mock_esp32.py:186‚Äì191](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L186-L191>)                                                                                  | Schema matches SPEC                                                                                                                                                |
| P3  | `ack.edge_recv_ts_ms` is epoch ms                           | ‚ö†Ô∏è PARTIAL | Firmware: [mqtt_handler.c:83](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L83>) uses `esp_timer` (uptime, not epoch ‚Äî no NTP). Mock: [mock_esp32.py:190](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L190>) uses `time.time()` (epoch)         | **Convention difference:** Firmware uses monotonic uptime ms (no NTP on ESP32). Mock uses epoch ms. Both are valid for RTT calculation (Œît). Documented in API.md. |
| P4  | `state` fields: mode, phase, since_ms, uptime_s, ts_ms      | ‚ö†Ô∏è PARTIAL | [mqtt_handler.c:291‚Äì295](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L291-L295>): mode, phase, ts_ms, uptime_s ‚úÖ but **missing `since_ms`**; [mock_esp32.py:197‚Äì203](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L197-L203>): all 5 fields ‚úÖ | Firmware missing `since_ms` ‚Äî safe to add later. Mock has it. Dashboard reads it but gracefully handles absence.                                                   |
| P5  | `status` fields: online, ts_ms                              | ‚úÖ PASS    | [mqtt_handler.c:95‚Äì97](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L95-L97>); [mock_esp32.py:178‚Äì181](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L178-L181>)                                                                                  | LWT omits ts_ms (correct per SPEC "absent in LWT")                                                                                                                 |
| P6  | `telemetry` fields: rssi_dbm, heap_free_kb, uptime_s, ts_ms | ‚úÖ PASS    | [mqtt_handler.c:311‚Äì315](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L311-L315>); [mock_esp32.py:216‚Äì221](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L216-L221>)                                                                              | All 4 fields present                                                                                                                                               |

---

## 3. Safety Rules (SPEC ¬ß5 ‚Äî CRITICAL)

| ID  | Requirement                                               | Status     | Evidence                                                                                                                                                                                                                                                                              | Notes                                                                                                |
| --- | --------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| S1  | Single green direction (only 1 direction GREEN at a time) | ‚úÖ PASS    | [fsm_controller.c:50‚Äì77](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L50-L77>) `apply_phase()` ‚Äî switch cases never set both NS_GREEN + EW_GREEN                                                                                                    | Hardware interlock via FSM design                                                                    |
| S2  | ALL_RED ‚â• 2000ms between transitions                      | ‚úÖ PASS    | [Kconfig:140‚Äì143](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L140-L143>) default 2000ms, range 500-5000; [fsm_controller.c:36‚Äì39](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L36-L39>) phases 2,5 = ALL_RED_MS | ‚ö†Ô∏è Kconfig allows range down to 500ms ‚Äî below SPEC minimum. Recommended: increase range min to 2000. |
| S3  | MQTT offline > 10s ‚Üí fallback AUTO                        | ‚úÖ PASS    | [app_main.c:40‚Äì48](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/app_main.c#L40-L48>); [Kconfig:155‚Äì158](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L155-L158>) default 10000ms                                                    | Watchdog implemented correctly                                                                       |
| S4  | Idempotency: cache 32 cmd_ids                             | ‚úÖ PASS    | [mqtt_handler.c:44‚Äì48](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L44-L48>) `CMD_ID_CACHE_SIZE=32`; [mock_esp32.py:57](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L57>) `deque(maxlen=32)`                             | Duplicate returns ok=true without re-execution                                                       |
| S5  | Duplicate ‚Üí ack ok=true, no re-execution                  | ‚úÖ PASS    | [mqtt_handler.c:132‚Äì137](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L132-L137>); [mock_esp32.py:107‚Äì110](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L107-L110>)                                                        | ‚Äî                                                                                                    |
| S6  | MIN_GREEN 5000ms                                          | ‚ö†Ô∏è PARTIAL | [Kconfig:130‚Äì133](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L130-L133>) default 8000ms ‚úÖ but range allows 1000ms ‚ùå                                                                                                                             | Config allows violation. Default is safe. Low-risk: only changeable via menuconfig.                  |
| S7  | YELLOW fixed 3000ms                                       | ‚úÖ PASS    | [Kconfig:135‚Äì138](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L135-L138>) default 3000ms                                                                                                                                                           | Range 1000-10000 allows deviation but default correct                                                |
| S8  | SET_PHASE rejected unless MANUAL mode                     | ‚úÖ PASS    | [fsm_controller.c:169‚Äì174](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L169-L174>); [mock_esp32.py:139‚Äì141](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L139-L141>)                                                    | ‚Äî                                                                                                    |

---

## 4. Operating Modes (SPEC ¬ß6)

| ID  | Requirement                             | Status     | Evidence                                                                                                                                                                                                                                                                                          | Notes                                                                                                                                                                |
| --- | --------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| M1  | AUTO mode: FSM auto-cycle               | ‚úÖ PASS    | [fsm_controller.c:92‚Äì101](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L92-L101>); [mock_esp32.py:229‚Äì232](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L229-L232>)                                                                  | Both cycle 0‚Üí5                                                                                                                                                       |
| M2  | MANUAL mode: dashboard controls phase   | ‚úÖ PASS    | [fsm_controller.c:104‚Äì105](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L104-L105>); dashboard SET_PHASE button                                                                                                                                                  | ‚Äî                                                                                                                                                                    |
| M3  | BLINK mode: yellow blink all directions | ‚úÖ PASS    | [fsm_controller.c:107‚Äì109](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L107-L109>) `gpio_lights_toggle_yellow()`; [mock_esp32.py:234‚Äì236](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L234-L236>) toggle ALL_RED/off               | Firmware: yellow blink ‚úÖ. Mock: red/off toggle ‚Äî visual approximation.                                                                                              |
| M4  | OFF mode: all lights off                | ‚úÖ PASS    | [fsm_controller.c:111‚Äì112](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L111-L112>) `gpio_lights_all_off()`; [mock_esp32.py:238](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L238>)                                                 | ‚Äî                                                                                                                                                                    |
| M5  | EMERGENCY cmd ‚Üí BLINK mode              | ‚ö†Ô∏è PARTIAL | [mqtt_handler.c:164‚Äì168](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L164-L168>) sets `MODE_MANUAL + phase 2 (ALL_RED)`; [mock_esp32.py:153‚Äì158](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L153-L158>) sets `MODE_BLINK + phase 2` | **Discrepancy:** Firmware ‚Üí MANUAL+ALL_RED (safer, all red static). Mock ‚Üí BLINK. SPEC says BLINK. Firmware choice is **more conservative** ‚Äî acceptable for safety. |

---

## 5. Phase Definitions (SPEC ¬ß7)

| ID  | Requirement                                          | Status  | Evidence                                                                                                                                                                                                                                                                                                              | Notes                |
| --- | ---------------------------------------------------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| PH1 | 6 phases: 0=NS_G, 1=NS_Y, 2=AR, 3=EW_G, 4=EW_Y, 5=AR | ‚úÖ PASS | [fsm_controller.c:5‚Äì11](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L5-L11>); [mock_esp32.py:55](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L55>); [dashboard:643‚Äì650](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L643-L650>) | All three consistent |
| PH2 | Phase 0: NS=Green, EW=Red                            | ‚úÖ PASS | [fsm_controller.c:53‚Äì55](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L53-L55>) NS(0,0,1) EW(1,0,0)                                                                                                                                                                                  | ‚Äî                    |
| PH3 | Phase 2,5: ALL_RED                                   | ‚úÖ PASS | [fsm_controller.c:60‚Äì62](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L60-L62>) `gpio_lights_all_red()`                                                                                                                                                                              | ‚Äî                    |
| PH4 | Default fallback: all_red                            | ‚úÖ PASS | [fsm_controller.c:72‚Äì73](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/fsm_controller.c#L72-L73>) default case ‚Üí all_red                                                                                                                                                                               | Fail-safe            |

---

## 6. Timing & Intervals (SPEC ¬ß9)

| ID  | Requirement                    | Status  | Evidence                                                                                                                                                                                                                                                                                                                                          | Notes                                                    |
| --- | ------------------------------ | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------- |
| TM1 | State publish every 1000ms     | ‚úÖ PASS | [Kconfig:145‚Äì148](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L145-L148>) default 1000; [app_main.c:56‚Äì58](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/app_main.c#L56-L58>); [mock_esp32.py:247](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L247>) `sleep(1.0)` | ‚Äî                                                        |
| TM2 | Telemetry publish every 5000ms | ‚úÖ PASS | [Kconfig:150‚Äì153](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L150-L153>) default 5000; [app_main.c:61‚Äì63](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/app_main.c#L61-L63>); [mock_esp32.py:244‚Äì246](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L244-L246>)     | ‚Äî                                                        |
| TM3 | CMD_ID_CACHE_SIZE = 32         | ‚úÖ PASS | [mqtt_handler.c:45](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L45>); [mock_esp32.py:57](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L57>)                                                                                                                                          | ‚Äî                                                        |
| TM4 | MQTT keepalive 30s             | ‚úÖ PASS | [dashboard:675](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L675>) `keepalive: 30`; [mock_esp32.py:232](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L232>) `keepalive=30`                                                                                                                     | Firmware: uses ESP-IDF MQTT defaults (120s) ‚Äî acceptable |

---

## 7. Error Codes (SPEC ¬ß8)

| ID  | Requirement                              | Status     | Evidence                                                                                                                                                                                                                                                                          | Notes                                                                                       |
| --- | ---------------------------------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| E1  | ERR_INVALID_CMD                          | ‚úÖ PASS    | [mqtt_handler.c:120‚Äì124](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L120-L124>); [mock_esp32.py:100‚Äì104](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L100-L104>)                                                    | ‚Äî                                                                                           |
| E2  | ERR_UNKNOWN_TYPE                         | ‚úÖ PASS    | [mqtt_handler.c:170](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L170>); [mock_esp32.py:161‚Äì162](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L161-L162>)                                                             | ‚Äî                                                                                           |
| E3  | ERR_SAFETY_VIOLATION (reject unsafe cmd) | ‚ö†Ô∏è PARTIAL | Firmware: [mqtt_handler.c:159](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/mqtt_handler.c#L159>) uses `ERR_PHASE_REJECTED`; Mock: [mock_esp32.py:140](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/logger/tools/mock_esp32.py#L140>) uses `ERR_NOT_MANUAL_MODE` | Error code string differs from SPEC name. Functionality correct ‚Äî rejects unsafe SET_PHASE. |

---

## 8. Dashboard (SPEC ¬ß1 ‚Äî Node-RED/Dashboard)

| ID  | Requirement                            | Status  | Evidence                                                                                                                                             | Notes |
| --- | -------------------------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----- |
| D1  | Dashboard shows mode, phase, status    | ‚úÖ PASS | [dashboard:717‚Äì730](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L717-L730>) `handleState()` displays mode, phase, uptime      | ‚Äî     |
| D2  | Dashboard sends SET_MODE cmd           | ‚úÖ PASS | [dashboard:836‚Äì840](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L836-L840>) `sendMode()` publishes to /cmd QoS1               | ‚Äî     |
| D3  | Dashboard sends SET_PHASE cmd          | ‚úÖ PASS | [dashboard:843‚Äì850](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L843-L850>) `sendPhase()` publishes to /cmd QoS1              | ‚Äî     |
| D4  | Dashboard shows telemetry (RSSI, heap) | ‚úÖ PASS | [dashboard:744‚Äì752](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L744-L752>) `handleTelemetry()` displays rssi, heap, uptime   | ‚Äî     |
| D5  | Dashboard shows ESP32 online/offline   | ‚úÖ PASS | [dashboard:732‚Äì742](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L732-L742>) `handleStatus()` reads LWT status                 | ‚Äî     |
| D6  | Dashboard shows ACK log                | ‚úÖ PASS | [dashboard:754‚Äì768](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/dashboard/index.html#L754-L768>) `handleAck()` with slide-in animation, 20 entries | ‚Äî     |

---

## 9. Hardware (SPEC ¬ß10)

| ID  | Requirement                           | Status | Evidence                                                                                                                                                                                                                      | Notes                                   |
| --- | ------------------------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- |
| H1  | GPIO pinmap for 4 directions √ó 3 LEDs | üî≤ N/A | [Kconfig:61‚Äì127](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/Kconfig.projbuild#L61-L127>) 12 GPIO pins defined; [gpio_lights.c](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/gpio_lights.c>) | Requires hardware to verify LED control |
| H2  | WiFi connection + RSSI                | üî≤ N/A | [wifi_manager.c](<file:///d:/Nam%202(D)/NCKH/traffic-mqtt-demo/esp32_idf/main/wifi_manager.c>)                                                                                                                                | Requires hardware                       |

---

## Summary

| Category           | Total  | ‚úÖ PASS | ‚ö†Ô∏è PARTIAL | ‚ùå FAIL | üî≤ N/A |
| ------------------ | ------ | ------- | ---------- | ------- | ------ |
| MQTT Topics & QoS  | 7      | 7       | 0          | 0       | 0      |
| Payload Schemas    | 6      | 3       | 3          | 0       | 0      |
| Safety Rules       | 8      | 6       | 2          | 0       | 0      |
| Operating Modes    | 5      | 4       | 1          | 0       | 0      |
| Phase Definitions  | 4      | 4       | 0          | 0       | 0      |
| Timing & Intervals | 4      | 4       | 0          | 0       | 0      |
| Error Codes        | 3      | 2       | 1          | 0       | 0      |
| Dashboard          | 6      | 6       | 0          | 0       | 0      |
| Hardware           | 2      | 0       | 0          | 0       | 2      |
| **TOTAL**          | **45** | **36**  | **7**      | **0**   | **2**  |

> **Result: 36 PASS + 7 PARTIAL + 0 FAIL + 2 N/A (hardware)**
> All PARTIAL items are documented with conservative rationale.
> No FAIL items ‚Äî repo is SPEC-compliant for mock validation.
